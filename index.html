<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Mapbox Directions</title>

    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
    <script src='//api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.uncompressed.js'></script>
    <link href='//api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.css' rel='stylesheet' />

    <script src='dist/mapbox.directions.js'></script>
    <link href='dist/mapbox.directions.css' rel='stylesheet' />

    <script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-hash/v0.2.1/leaflet-hash.js'></script>

    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            border: 0;
            color: rgba(0,0,0,.75);
        }

        #map {
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
        }
        #inputs,
        #routes,
        #instructions {
            position: fixed;
            z-index: 10;
            left: 10px;
            width: 33.3333%;
            max-width: 300px;
            min-width: 250px;
            -webkit-transition: -webkit-transform 200ms;
               -moz-transition:    -moz-transform 200ms;
                 -o-transition:      -o-transform 200ms;
                    transition:         transform 200ms;
        }
        #inputs {top: 10px;}
        #routes { top: 90px; }
        #instructions {
            z-index: 10;
            background: rgba(0,0,0,.8);
            top: 0px;
            left: 0;
            height: 100%;
            bottom: 0px;
            overflow: auto;
            -webkit-transform:translateX(-100%);
               -moz-transform:translateX(-100%);
                 -o-transform:translateX(-100%);
                    transform:translateX(-100%);
        }
        .active #routes,
        .active #inputs {
            -webkit-transform:translateX(100%);
               -moz-transform:translateX(100%);
                 -o-transform:translateX(100%);
                    transform:translateX(100%);
        }
        .active #instructions {
            -webkit-transform:translateX(0%);
               -moz-transform:translateX(0%);
                 -o-transform:translateX(0%);
                    transform:translateX(0%);
        }

        #instructions::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            border-left: 0;
            background: rgba(255, 255, 255, .1);
        }

        #instructions::-webkit-scrollbar-track {
            background: none;
        }

        #instructions::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .1);
            border-radius: 0;
        }

        #instructions::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, .2);
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id='inputs'></div>
<div id='directions'>
    <div id='errors'></div>
    <div id='routes'></div>
    <div id='instructions'></div>
</div>

<div id='map'>
</div>

<script>
    var map = L.mapbox.map('map', 'examples.map-9ijuk24y', {
        worldCopyJump: true
    }).setView([37.77, -122.44], 13);

    map.zoomControl.setPosition('topright');

    var directions = L.mapbox.directions('willwhite.map-65rb3vvx');

    var directionsLayer = L.mapbox.directions.layer(directions)
        .addTo(map);

    var directionsInputControl = L.mapbox.directions.inputControl('inputs', directions)
        .addTo(map);

    var directionsErrorsControl = L.mapbox.directions.errorsControl('errors', directions)
        .addTo(map);

    var directionsRoutesControl = L.mapbox.directions.routesControl('routes', directions)
        .addTo(map);

    var directionsInstructionsControl = L.mapbox.directions.instructionsControl('instructions', directions)
        .addTo(map);

    var hash = new L.Hash(map);

    // Use #z/lon/lat rather than #z/lat/lon

    hash.parseHash = function(hash) {
        if(hash.indexOf('#') === 0) {
            hash = hash.substr(1);
        }
        var args = hash.split("/");
        if (args.length == 3) {
            var zoom = parseInt(args[0], 10),
                lon = parseFloat(args[1]),
                lat = parseFloat(args[2]);
            if (isNaN(zoom) || isNaN(lat) || isNaN(lon)) {
                return false;
            } else {
                return {
                    center: new L.LatLng(lat, lon),
                    zoom: zoom
                };
            }
        } else {
            return false;
        }
    };

    hash.formatHash = function(map) {
        var center = map.getCenter(),
            zoom = map.getZoom(),
            precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));

        return "#" + [zoom,
            center.lng.toFixed(precision),
            center.lat.toFixed(precision)
        ].join("/");
    };

    var waypoints = decodeURIComponent(window.location.search.split('route=').pop()).split(';');
    if (waypoints.length == 2) {
        directions
            .setOrigin(L.latLng(waypoints[0].split(',').reverse()))
            .setDestination(L.latLng(waypoints[1].split(',').reverse()))
            .query();
    }

    directions.on('load', function() {
        var precision = Math.max(0, Math.ceil(Math.log(map.getZoom()) / Math.LN2)),
            o = directions.getOrigin(),
            d = directions.getDestination();
        history.replaceState({}, null, '?route=' + [o.lng.toFixed(precision), o.lat.toFixed(precision)]
                                           + ';' + [d.lng.toFixed(precision), d.lat.toFixed(precision)]
                                           + location.hash);
    });
</script>

</body>
</html>
