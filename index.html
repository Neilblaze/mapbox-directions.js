<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Mapbox Directions</title>

    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
    <script src='//api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.uncompressed.js'></script>
    <link href='//api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.css' rel='stylesheet' />

    <script src='dist/mapbox.directions.js'></script>
    <link href='dist/mapbox.directions.css' rel='stylesheet' />

    <script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-hash/v0.2.1/leaflet-hash.js'></script>

    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            border: 0;
            color: rgba(0,0,0,.75);
        }

        #sidebar, #map {
            height: 100%;
        }

        #sidebar {
            position: absolute;
            overflow: auto;
            left: 0;
            bottom: 0;
            top: 0;
            width: 350px;
        }

        #map {
            position: absolute;
            left: 350px;
            top: 0;
            bottom: 0;
            right: 0;
        }

        #logo {
            position: absolute;
            padding: 10px;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
        }

        #logo span {
            -webkit-background-size: 225px 350px;
                    background-size: 225px 350px;

            background: transparent url('https://www.mapbox.com/base/latest/base.png') no-repeat 0px -250px;
            display: inline-block;
            vertical-align: middle;
            height: 40px;
            width: 100px;
            text-indent: -999em;
            overflow: hidden;
            padding-top: 10px;
            padding-bottom: 10px;
            position: relative;
            z-index: 10;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        #inputs {
            border-top: 1px solid #e5e5e5;
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
        }

        #directions {
            border-top: 1px solid #e5e5e5;
            position: absolute;
            left: 0;
            right: 0;
            top: 170px;
            bottom: 0;
            overflow: auto;
        }

        #directions::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            border-left: 0;
            background: rgba(0, 0, 0, .1);
        }

        #directions::-webkit-scrollbar-track {
            background: none;
        }

        #directions::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, .1);
            border-radius: 0;
        }

        #directions::-webkit-scrollbar:hover {
            background: rgba(0, 0, 0, .15);
        }
    </style>
</head>
<body>

<div id='sidebar'>
    <div id='logo'>
        <span></span>
    </div>

    <div id='inputs'></div>
    <div id='directions'>
        <div id='errors'></div>
        <div id='routes'></div>
        <div id='instructions'></div>
    </div>
</div>

<div id='map'>
</div>

<script>
    var map = L.mapbox.map('map', 'examples.map-9ijuk24y', {
        worldCopyJump: true,
        infoControl: { editLink: true }
    }).setView([37.77, -122.44], 13);

    var directions = L.mapbox.directions('willwhite.map-65rb3vvx');

    var directionsLayer = L.mapbox.directions.layer(directions)
        .addTo(map);

    var directionsInputControl = L.mapbox.directions.inputControl('inputs', directions)
        .addTo(map);

    var directionsErrorsControl = L.mapbox.directions.errorsControl('errors', directions)
        .addTo(map);

    var directionsRoutesControl = L.mapbox.directions.routesControl('routes', directions)
        .addTo(map);

    var directionsInstructionsControl = L.mapbox.directions.instructionsControl('instructions', directions)
        .addTo(map);

    var hash = new L.Hash(map);

    // Use #z/lon/lat rather than #z/lat/lon

    hash.parseHash = function(hash) {
        if(hash.indexOf('#') === 0) {
            hash = hash.substr(1);
        }
        var args = hash.split("/");
        if (args.length == 3) {
            var zoom = parseInt(args[0], 10),
                lon = parseFloat(args[1]),
                lat = parseFloat(args[2]);
            if (isNaN(zoom) || isNaN(lat) || isNaN(lon)) {
                return false;
            } else {
                return {
                    center: new L.LatLng(lat, lon),
                    zoom: zoom
                };
            }
        } else {
            return false;
        }
    };

    hash.formatHash = function(map) {
        var center = map.getCenter(),
            zoom = map.getZoom(),
            precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));

        return "#" + [zoom,
            center.lng.toFixed(precision),
            center.lat.toFixed(precision)
        ].join("/");
    };

    var waypoints = decodeURIComponent(window.location.search.split('route=').pop()).split(';');
    if (waypoints.length == 2) {
        directions
            .setOrigin(L.latLng(waypoints[0].split(',').reverse()))
            .setDestination(L.latLng(waypoints[1].split(',').reverse()))
            .query();
    }

    directions.on('load', function() {
        var precision = Math.max(0, Math.ceil(Math.log(map.getZoom()) / Math.LN2)),
            o = directions.getOrigin(),
            d = directions.getDestination();
        history.replaceState({}, null, '?route=' + [o.lng.toFixed(precision), o.lat.toFixed(precision)]
                                           + ';' + [d.lng.toFixed(precision), d.lat.toFixed(precision)]
                                           + location.hash);
    });
</script>

</body>
</html>
